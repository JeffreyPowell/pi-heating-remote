<?php 
w1dir = "/sys/bus/onewire/?/";
header('Content-Type: application/xml');

$aliasfile = '/home/pi/pi-heating/config/sensors.ini';

if (file_exists($aliasfile)) {
    echo "The file $aliasfile exists";
} else {
    echo "The file $aliasfile does not exist";
}


$aliases = parse_ini_file($aliasfile);

$sensors = scandir($w1dir);

// Scan sensors

$output = "<root>";

foreach ($sensors as $sensor){
    $raw_data = file_get_contents(w1dir.$sensor.'/?');
    $value = $raw_data * 1.0;
    $name = $aliases[$sensor];
    if( $name == '' ) {
        $name = $sensor;
    }

    $output .= "<sensor><id>".$sensor."</id><name>".$name."</name><value>".$value."</value></sensor>";
}

$output .= "</root>";
print ($output);
?> 
